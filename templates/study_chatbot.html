{% extends 'base.html' %}
{% set show_nav = false %}

{% block title %}Study Assistant - AURA{% endblock %}

{% block body_class %}study-page{% endblock %}

{% block extra_css %}
<script>
// Set dark theme immediately before any CSS loads
(function() {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('study-page-root');
})();
</script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/study-assistant.css', v=15) }}">
<style>
/* CRITICAL: Override ALL base styles for study chat page */
html.study-page-root,
body.study-page {
    height: 100vh !important;
    width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
    background: #0f0f11 !important;
    color: #e8e8ed !important;
}

body.study-page main {
    padding: 0 !important;
    max-width: none !important;
    margin: 0 !important;
    height: 100vh !important;
    background: #0f0f11 !important;
}

body.study-page header,
body.study-page .dashboard-nav,
body.study-page nav.dashboard-nav {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    opacity: 0 !important;
}

/* Force dark theme variables */
body.study-page {
    --bg-primary: #0f0f11 !important;
    --bg-surface: #1a1a1f !important;
    --bg-elevated: #232329 !important;
    --bg-input: #2a2a32 !important;
    --text-main: #e8e8ed !important;
    --text-muted: #9898a6 !important;
    --border-color: #3a3a45 !important;
    --accent: #8b7cf7 !important;
}

/* Override global button styles */
body.study-page .new-chat-btn {
    background: #8b7cf7 !important;
    color: #ffffff !important;
    border: none !important;
    border-radius: 12px !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
}

body.study-page .study-container {
    background: #0f0f11 !important;
}

body.study-page .study-sidebar {
    background: #1a1a1f !important;
    border-color: #3a3a45 !important;
}

body.study-page .chat-main {
    background: #0f0f11 !important;
}

body.study-page .input-pill {
    background: #2a2a32 !important;
    border-color: #3a3a45 !important;
}

body.study-page .input-pill input,
body.study-page .input-pill textarea,
body.study-page #studyChatInput {
    background: transparent !important;
    color: #e8e8ed !important;
    border: none !important;
}

body.study-page .input-pill input::placeholder,
body.study-page #studyChatInput::placeholder {
    color: #6b6b7a !important;
}
</style>
{% endblock %}

{% block content %}
<div class="study-container">
    <!-- Left Sidebar - Chat History -->
    <aside class="study-sidebar study-sidebar-left">
        <div class="sidebar-top">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">ğŸ“š</div>
                <span class="logo">AURA</span>
            </div>
            <div class="focus-mode-toggle">
                <span class="focus-label">Focus Mode</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="focusModeToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <button class="new-chat-btn" id="newStudyChatBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                <span>+ New Study Session</span>
            </button>
        </div>
        <div class="history-section">
            <p class="section-label">Recent Sessions</p>
            <div id="study-history-list" class="history-list">
                <div class="history-item">
                    <span class="history-item-icon">âœï¸</span>
                    <span class="history-item-text">Physics Homework</span>
                </div>
                <div class="history-item">
                    <span class="history-item-icon">ğŸ“</span>
                    <span class="history-item-text">Essay Outline</span>
                </div>
                <div class="history-item">
                    <span class="history-item-icon">ğŸ“·</span>
                    <span class="history-item-text">Image Analysis</span>
                </div>
                <div class="history-item">
                    <span class="history-item-icon">ğŸ‘¥</span>
                    <span class="history-item-text">Mock Exam Practice</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Center - Main Chat Area -->
    <main class="chat-viewport study-viewport">
        <header class="chat-top-nav">
            <div class="model-selector">
                <span class="model-selector-icon">ğŸ“</span>
                Study Assistant
            </div>
            <div class="nav-actions">
                <button id="theme-toggle" class="gemini-btn-icon" aria-label="Toggle theme" title="Switch theme">
                    <span class="theme-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </span>
                </button>
                <div class="user-profile">
                    {{ session.get('user_name', 'Student') }}
                </div>
                <a href="/student-dashboard" class="dashboard-btn">Dashboard</a>
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </header>

        <!-- Messages Container -->
        <div id="study-messages" class="messages-container">
            <!-- Welcome State -->
            <div class="welcome-state" id="studyWelcomeState">
                <h1>Welcome back! What are you learning today?</h1>
                <p>I can help with homework, explain concepts, generate flashcards, and more.</p>
                <div class="quick-chips">
                    <button class="quick-chip" data-prompt="Summarize this PDF">
                        <span class="quick-chip-icon">ğŸ“„</span> Summarize PDF
                    </button>
                    <button class="quick-chip" data-prompt="Generate flashcards">
                        <span class="quick-chip-icon">ğŸ´</span> Generate Flashcards
                    </button>
                    <button class="quick-chip" data-prompt="Explain concept">
                        <span class="quick-chip-icon">ğŸ’¡</span> Explain Concept
                    </button>
                    <button class="quick-chip" data-prompt="Create quiz">
                        <span class="quick-chip-icon">ğŸ“</span> Create Quiz
                    </button>
                </div>
            </div>
        </div>

        <!-- Input Area - Fixed Position -->
        <div class="study-input-wrapper">
            <div class="study-pill">
                <input type="file" id="fileUpload" hidden accept=".pdf,.png,.jpg,.jpeg,.txt,.doc,.docx">
                <button type="button" class="action-icon" id="attachFileBtn" onclick="document.getElementById('fileUpload').click()">ğŸ“</button>
                
                <input type="text" id="studyChatInput" placeholder="Ask a question or explain a file..." autocomplete="off" required>
                
                <button type="button" id="study-send-btn" class="action-icon">ğŸš€</button>
            </div>
            <p class="disclaimer">AURA Study Assistant: Analyze files and generate quizzes instantly.</p>
        </div>
    </main>

    <!-- Right Sidebar - Study Hub -->
    <aside class="study-hub study-sidebar-right">
        <div class="hub-header">
            <h3>Study Hub</h3>
        </div>
        
        <div class="hub-section">
            <p class="hub-section-title">Quick Actions</p>
            <div class="hub-actions">
                <button class="hub-action-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                    </svg>
                    <span>Upload File</span>
                </buttontools">
            <button class="tool-btn" onclick="triggerSummarize()">ğŸ“„ Summarize PDF</button>
            <button class="tool-btn" onclick="triggerQuiz()">ğŸ“ Generate Quiz</button>
            <button class="tool-btn" onclick="triggerFlashcards()">ğŸ´ Create Flashcards</button>
        </div>

        <div class="file-manager">
            <p>Active Files</p>
            <div id="fileList" class="active-files">
                <div class="file-item">
                    <span>ğŸ“„ quantum_notes.pdf</span>
                </div>
                <div class="file-item">
                    <span>ğŸ–¼ï¸ diagram.png</span>
                </div>
            </div>
        </div>

        <div class="hub-section">
            <p class="hub-section-title">Study Tips</p>
            <ul class="tips-list">
                <li>Upload PDFs or images for instant analysis</li>
                <li>Ask follow-up questions about uploaded content</li>
                <li>Generate quizzes to test your understanding</li>
                <li>Use flashcards for active learning</li>
            </ul
// Initialize theme
if (typeof initTheme === 'function') {
    initTheme();
}

// Initialize study chat
if (typeof initStudyChat === 'function') {
    initStudyChat();
}
</script>
{% endblock %}
