{% extends 'base.html' %}
{% set show_nav = false %}

{% block title %}Mental Wellness - AURA{% endblock %}

{% block body_class %}mental-page{% endblock %}

{% block extra_css %}
<script>
// Set dark theme immediately before any CSS loads
(function() {
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('mental-page-root');
})();
</script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/mental-chatbot.css', v=12) }}">
<style>
/* CRITICAL: Override ALL base styles for mental chat page */
html.mental-page-root,
body.mental-page {
    height: 100vh !important;
    width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
    background: #0f0f11 !important;
    color: #e8e8ed !important;
}

body.mental-page main {
    padding: 0 !important;
    max-width: none !important;
    margin: 0 !important;
    height: 100vh !important;
    background: #0f0f11 !important;
}

body.mental-page header,
body.mental-page .dashboard-nav,
body.mental-page nav.dashboard-nav {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    opacity: 0 !important;
}

/* Force dark theme variables */
body.mental-page {
    --bg-primary: #0f0f11 !important;
    --bg-surface: #1a1a1f !important;
    --bg-elevated: #232329 !important;
    --bg-input: #2a2a32 !important;
    --text-main: #e8e8ed !important;
    --text-muted: #9898a6 !important;
    --border-color: #3a3a45 !important;
    --accent: #8b7cf7 !important;
}

/* Override global button styles */
body.mental-page .new-chat-btn {
    background: #8b7cf7 !important;
    color: #ffffff !important;
    border: none !important;
    border-radius: 12px !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
}

body.mental-page .gemini-container {
    background: #0f0f11 !important;
}

body.mental-page .gemini-sidebar {
    background: #1a1a1f !important;
    border-color: #3a3a45 !important;
}

body.mental-page .chat-main {
    background: #0f0f11 !important;
}

body.mental-page .input-pill {
    background: #2a2a32 !important;
    border-color: #3a3a45 !important;
}

body.mental-page .input-pill input,
body.mental-page .input-pill textarea,
body.mental-page #messageInput {
    background: transparent !important;
    color: #e8e8ed !important;
    border: none !important;
}

body.mental-page .input-pill input::placeholder,
body.mental-page #messageInput::placeholder {
    color: #6b6b7a !important;
}
</style>
{% endblock %}

{% block content %}
<div class="gemini-container">
    <!-- Sidebar -->
    <aside class="gemini-sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">🧠</div>
                <span>AURA</span>
            </div>
            <button class="new-chat-btn" id="newChatBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 5v14M5 12h14"/>
                </svg>
                <span>New chat</span>
            </button>
        </div>
        <div class="history-section">
            <p class="section-label">Recent</p>
            <div id="history-list" class="history-list">
                <div class="history-empty">No conversations yet</div>
            </div>
        </div>
    </aside>

    <!-- Chat Viewport -->
    <main class="chat-viewport">
        <header class="chat-top-nav">
            <div class="model-selector">
                <span class="model-selector-icon">💬</span>
                AURA Mental Support
            </div>
            <div class="nav-actions" style="display: flex; gap: 10px; align-items: center;">
                <button id="theme-toggle" class="gemini-btn-icon" aria-label="Toggle theme" title="Switch theme">
                    <span class="theme-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </span>
                </button>
                <div class="user-profile">
                    {{ session.get('user_name', 'Student') }}
                </div>
                <button class="zen-btn" id="zenModeToggle" title="Toggle Zen Mode">Zen Mode</button>
                <a href="/logout" class="logout-btn" style="padding: 8px 14px; border-radius: 20px; background: var(--accent); color: white; text-decoration: none; font-size: 14px; transition: all 0.2s;">Logout</a>
            </div>
        </header>

        <!-- Messages -->
        <div id="chat-messages" class="messages-container">
            <!-- Welcome State -->
            <div class="welcome-state" id="welcomeState">
                <h1>Hello, how can I help?</h1>
                <p>I'm here to listen and support you. Share what's on your mind, and we'll work through it together.</p>
                <div class="quick-chips">
                    <button class="quick-chip" data-prompt="I'm feeling stressed about work">
                        <span class="quick-chip-icon">😓</span> Feeling stressed
                    </button>
                    <button class="quick-chip" data-prompt="I need help with anxiety">
                        <span class="quick-chip-icon">😰</span> Anxiety help
                    </button>
                    <button class="quick-chip" data-prompt="I want to practice mindfulness">
                        <span class="quick-chip-icon">🧘</span> Mindfulness
                    </button>
                    <button class="quick-chip" data-prompt="I'm having trouble sleeping">
                        <span class="quick-chip-icon">😴</span> Sleep issues
                    </button>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area-wrapper">
            <form id="chatForm" class="input-pill">
                <input type="text" id="chat-input" placeholder="Type your message here..." autocomplete="off" required>
                <div class="input-actions">
                    <button type="submit" id="send-btn" class="send-icon-btn">
                        <svg viewBox="0 0 24 24">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </form>
            <p class="input-disclaimer">AURA can provide support but is not a substitute for professional help.</p>
        </div>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="{{ url_for('static', filename='js/theme-engine.js', v=10) }}"></script>
<script src="{{ url_for('static', filename='js/chat-engine.js', v=12) }}"></script>
<script>
// Initialize theme and chat engines
if (typeof initTheme === 'function') {
    initTheme();
}
if (typeof initChat === 'function') {
    initChat();
}
</script>
{% endblock %}
